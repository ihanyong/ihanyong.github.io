总得来说，2PC不是一个最优的分布式解决方案，但是可以通过对2PC的深入解析来加深对分布式事务的理解。


# 原子性 & 分布式
一般对事务原子性的定义： 一个事务的结果要么是全部提交成功， 要么全部回滚。 不会出现部分成功部分失败的状态。 

在单节点数据库系统中，我们可能通过存储引擎来保证事务原子性。在应用程序用不需要过多考虑事务问题，数据库会管理事务的提交与回滚等。

但是在多个数据库节点上事务是怎样的呢？ 比如一个事务中需要更新的两张表分在两个数据库节点上， 或者主数据与数据的索引不在同一个节点上。  如果只是简单的向所有节点发送提交请求，各节点独立提交事务是不够的了。很容易就造成部分节点上提交成功而部分节点上提交失败，就破坏了原子性：
- 有些节点上可能会出现数据的冲突而提交失败，有些节点可以提交成功；
- 网络原因，提交事务的通知没有到达部分节点；
- 部分节点的磁盘故障，造成该节点上事务没有提交；而其它节点上提交成功；

在分布式的环境下，为保证一致性，所有节点上的事务要么一些成功，要么一起失败。和在单节点上的原子性要求是一样的。

# 2PC
两阶段提交（tow-phase commit）是一种保证多节点事务原子性的算法。即能确保事务在所有节点上一起成功或者一起失败。

![执行成功的2PC示意图](../..\img\system\successful2pc.png)
