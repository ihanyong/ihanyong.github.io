编码与演进


> EveryThing changes and nothing stands still.  -- Heraclitus of Ephesus, as qouted by Plato in Cratylus(360 BCE)


随着时间推移，应用是必然的发生变化的。 如添加修改功能， 对用户需求理解的加深， 商业模式的变化等。 我们应该致力于构建对变化友好的系统。

在大多数情况下， 一个应用功能的变更也会需要对存储的数据进行变更： 添加新字段， 处理新的数据类型， 或者是以新的方式使用存量数据。

不同的数据模型有不同的方式来处理这种变化。 关系型数据库一般假设表中所有的数据都是同一种模式： 尽管可以对模式进行修改（ALTER）， 但在任何时间点只能有一种模式。 相对的， 无模式的数据库（schema-on-read, schemaless）不强制要求模式定义， 所以这类数据库可以将新格式的数据与老格式的数据混合存放。

将数据格式的模式发生了变化， 一般需要相应的修改应用程序的代码（）。但很大一部分的应用，代码的修改并不能立即的发布：

- 服务端应用： 灰度升级，新版本先部署到部分节点上来验证运行状况，并逐步地升级所有的节点。这样不需要停服进行升级，可以进行快节奏的频繁的发布与系统演进。
- 客户端应用：用户可能不会安装更新。

这就意味着新新老版本的代码与数据格式可能会同时并存。 为了系统平稳运行，我们需要同时维护两个方向的兼容性：
- 向后兼容：新代码可以读取老代码写的数据
- 向前兼容：老代码可以读取新代码写的数据

身后兼容一般没那么难： 作为新代码的作者， 是知道老数据格式的，可以显示的处理（必要的话可以保留老版本的代码来处理老数据）。 向前兼容一般就比较棘手，要求老版本的代码忽略新版本偌的增项。


# Formats for Encoding Data

[TODO]

