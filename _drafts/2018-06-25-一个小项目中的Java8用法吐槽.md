---
layout: post
title:  "吐槽一个小项目中的Java8用法"
date:   2018-06-25 10:30:00 +0800
author: "HanYong"
tags:
        - 经验
        - java
---
# 吐槽
最近接手了一个小项目， 拿到代码有些傻了， 可读性基本为零。 代码大面积的使用了Java8的新特性， 尤其是stream。 追求新技术新语法是程序员的一个必备要求， 但是这里的代码把这些新特性使用的像屎一样。 

## 建议
- 不适合把业务逻辑整个地生吞活剥的套在streams里进行处理, 毕竟steamAPI的目的是优化数据处理方式, 不是要把整个写逻辑代码的方式革命掉.
- lambada表达式要使用的恰当, 需要的时候, 用方法引用来重构lambada表达式. 
 
如下就是两个过分的例子.

```java
    public BaseResponse pageConfig(PageConfigRequest request) {
        return Optional.ofNullable(request.getPageId())
                .flatMap(pageId ->
                        Optional.ofNullable(pageId)
                                .map(pageRepository::findByPageId))
                .map(cmsPage -> PageConfigResponse.builder()
                        .pageInfo(cmsPage.getPageInfo())
                        .build())
                .map(BaseResponse::ok)
                .orElse(BaseResponse.error("page not found"));
    }
```




```java

    public BaseResponse createPage(CreatePageRequest request, User user) {

        log.debug("create page {}", user);


        return Optional.ofNullable(homePageRepository.findByPageName(request.getPageName()))
                .map(page -> BaseResponse.error("page name duplicate"))
                .orElseGet(() -> {
                    /**
                     * 封装 shopId 和 pageInfo
                     */
                    CmsHomePage rawPage = Optional.ofNullable(request.getCopyFromPageId())
                            .map(homePageRepository::findByPageId)
                            .flatMap(Optional::ofNullable)
                            .map(page -> {
                                CmsHomePage homePage = CmsHomePage.builder()
                                        .shopId(page.getShopId())
                                        .build();
                                homePage.setPageInfo(page.getPageInfo());
                                return homePage;
                            }).orElseGet(() -> {
                                CmsHomePage homePage = CmsHomePage.builder()
                                        .build();
                                homePage.setPageInfo("");
                                return homePage;
                            });

                    String shopId = Optional.ofNullable(request.getShopId())
                            .orElse(rawPage.getShopId());

                    CmsHomePage homePage = CmsHomePage.builder()
                            .shopId(shopId)
                            .build();
                    homePage.setProjectId(user.getProjectId());
                    homePage.setPlatform(request.getPlatform());
                    homePage.setPageName(request.getPageName());
                    homePage.setMinVersion(request.getMinVersion());
                    homePage.setPageInfo(rawPage.getPageInfo());
                    homePage.setEditor(user.getUserName());
                    homePage.setCreateBy(user.getUserName());
                    homePage.setStatus(CmsPage.PageStatus.DRAFT.name());


                    CmsHomePage result = homePageRepository.save(homePage);


                    log.debug("cmsPage create by user: {}", user);
                    PageCreateResponse response = PageCreateResponse.builder()
                            .pageId(result.getPageId())
                            .platform(result.getPlatform())
                            .pageName(result.getPageName())
                            .pageInfo(result.getPageInfo())
                            .pageStatus(result.getStatus())
                            .minVersion(result.getMinVersion())
                            .build();
                    return BaseResponse.ok(response);
                });
    }
```
